<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <title>Permis de Conduire</title>
<script>
// Je vous l'avais bien dit, non? Pas de funny business
// C'est enti√rement du code lisible
var numeropermis = '';
/*
Nom de famille:
1- B, F, P, V
2- C, G, K, J, Q, S, X, Z
3- D, T
4- L
5- M, N
6- R
*/
var cNom = { 'B':1, 'F':1, 'P':1, 'P':1, 'V':1, 'C':2, 'G':2, 'J':2, 'K':2, 'Q':2, 'S':2, 'X':2, 'Z':2, 'D':3, 'T':3, 'L':4, 'M':5, 'N':5, 'R':6 };
/*
Pr√©nom
1- A, B
2- C
3- D, E, F
4- G, H, I
5- J, K, L
6- M, N, O
7- P, Q, R
8- S, T
9- U, V, W, X, Y, Z
*/
var cPrenom = { 'A':1, 'B':1, 'C':2, 'D':3, 'E':3, 'F':3, 'G':4, 'H':4, 'I':4, 'J':5, 'K':5, 'L':5, 'M':6, 'N':6, 'O':6, 'P':7, 'Q':7, 'R':7, 'S':8, 'T':8, 'U':9, 'V':9, 'W':9, 'X':9, 'Y':9, 'Z':9 };

function normaliser(nom){
	//enlever les accents
	nom = nom.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
	//enlever les apostrophes et autres cochonneries
	nom = nom.replace(/[\s.,'\/#!$%\^&\*;:{}=\-_`~()]/g,"");
	//en majuscule
	nom = nom.toUpperCase();
	return nom;
}

function calculer(){
	//reset
	numeropermis='';
	document.getElementById("numeropermis").value='';
	//Aller chercher les valeurs
	var prenom  = normaliser(document.getElementById("prenom").value);
	var nom = normaliser(document.getElementById("nom").value);
	//enlever les lettres non-codif√es
	nom = nom.replace(/[AEIOUYHW]/g,"");
	//enlever les lettres doublons	
	nom = nom.replace(/((\w)\2)/g, '$2'); 
	var ddn = document.getElementById("ddn").value;

	if (prenom=='' || nom=='' || ddn==''){
		alert("Parametre manquant");
	} else {
			//premiere lettre du nom
			numeropermis=numeropermis+nom[0];

			// trois consonnes
			for(i=1;i<4;i++){
				if (nom[i]){
					numeropermis=numeropermis+cNom[nom[i]];
				}else{
					numeropermis=numeropermis+'0';
				}
			}

			//Premi√re lettre du pr√nom	
			numeropermis=numeropermis+cPrenom[[prenom[0]]];
			numeropermis=numeropermis+'-';

			//yyyy-mm-dd
			numeropermis=numeropermis+ddn.slice(8,10);
			numeropermis=numeropermis+ddn.slice(5,7);
			numeropermis=numeropermis+ddn.slice(2,4);

			//lastnumbers
			numeropermis=numeropermis+'-XX'
			//alert(nom);
			document.getElementById("numeropermis").innerHTML=numeropermis;
	}
}

</script>	
  </head>
  <body>
<strong>Vie priv&eacute;e: tout est calcul&eacute; localement, sans lien externe, vous pouvez v&eacute;rifier dans la source. </strong><br>
Date de Naissance :<input id="ddn" type="date" value="1980-01-01"><br>
<!--Date de Naissance (AAAA-MM-JJ):<input id="annee" type="number" size="4" maxlength="4" value="1980">-<input id="mois" type="number" size="2" maxlength="2">-<input id="jour" type="number" size="2" maxlength="2"><br>-->
Pr&eacute;nom:<input id="prenom" size="20"><br>
Nom:<input id="nom" size="20"><br>
<button type='button' onclick='calculer()'>Calculer</button><br>
Num&eacute;ro de permis de conduire:<strong><div id="numeropermis" size="20"></div><strong><br>
  </body>
</html>
